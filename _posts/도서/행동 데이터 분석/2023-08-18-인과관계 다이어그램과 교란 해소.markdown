---
layout: post
title: 인과관계 다이어그램과 교란 해소   
date: 2023-08-18 19:20:23 +0900
category: DA
use_math: true
---
# 행동 데이터 분석    
> 인과관계 다이어그램과 인과-행동 프레임워크  

인과관계 다이어그램: 변수를 상자로 표현하고 변수 사이의 관계를 상자 사이의 화살표로  
표현한 그림이다. 
ex)아이스 커피 매출은 기온이라는 요인의 영향을 받는다
기온 -> 아이스크림 커피 매출
화살표 방향으로 가리키고 있지 않은 것이 요인임을 나타낸다.  
관찰할 수 없는 변수의 경우 어두운 색의 상자를 사용한다.  
잔차(혹은 오차항)은 빈 원으로 표시한다.  

> 데이터를 나타내는 인과관계 다이어그램  

인과관계 다이어그램을 사용해 데이터의 변수 사이의 관계를 나타낼 수 있다.  
이런 관계가 완전히 또는 거의 선형일 때 인과관계 다이어그램을 선형대수학적으로 해석한다.  
즉, 선형대수의 규칙과 도구를 사용해 인과관계 다이어그램을 조작하고 변환하는 방법의  
합법성을 검증해 올바른 결론을 도출할 수 있다.  
  
선형대수의 어떤 규칙과 도구는 일부 관계가 선형은 아니지만 일반화된 선형 모델(GLM)이라는  
광범위한 모델 범주에 속할 때 그대로 적용할 수 있다.  

ex) $ IceCreamSales = \beta_{T}Temperature+\beta_{S}SummerMonth+\varepsilon $  
인과관계를 모르는 상태라면 이 방정식으로부터 기온이 1도 증가하는 것은  
아이스크림 매출이 beta_T달러 증가하는 것과 관련있다고 결론낼 수 있다.  
만약 인과관계 다이어그램이 회귀를 뒷받침한다면 인과관계 다이어그램이 사실인 경우  
기온이 1도 증가한다면 아이스크림 매출은 beta_T 달러 증가한다고 주장할 수 있다.  
기업은 이 정도의 추론을 필요로 한다.  

*확률 그래프 모형:확률 변수들 간의 조건 의존성을 그래프 형태로 나타낼 수 있는 통계 방법론이다.   
  
> 인과관계 다이어그램(causal diagram)은 사슬, 분기, 충돌로 이뤄져있다.  

사슬: 3개의 변수를 나타내는 3개의 상자와 각 상자를 직선으로 연결하는 2개의 화살표가 있는  
인과관계 다이어그램이다. 사슬 구조는 2개의 화살표가 같은 방향으로 연결되는 특징이 있다.  
(첫번째 상자는 두번째 상자를 가리키고, 두번째 상자는 세번째 상자를 가리킨다.)  
이는 부모(기온)와 자식(아이스커피 매출)관계로 나타내고 변수가 다른 변수와   
부모/자식관계를 가지는 경우 직접적인 관계라고 표현한다.  
만약 그 사이에 중간변수가 있으면 간접적인 관계라고 한다.   
최상위에 이는 부모 변수는 특정 변수의 조상이라고 하고 가장 아래에 있는 것은 자손이라고 한다.  
ex)기온->아이스 커피 매출->도넛 매출이라는 관계가 있을 때  
기온은 아이스 커피 매출이라는 자식변수의 부모변수가 된다.  
기온은 도넛 매출이라는 변수의 조상변수가 되고 도넛 매출은 자손변수가 된다.  
여기서 아이스 커피 매출은 기온과 도넛 매출 관계의 매개변수가 된다.  
여기서 아이스 커피가 매진되면 아이스 커피 재고가 생길 때까지 기온의 변화가 도넛 매출에  
영향을 미치지 않는다고 예상할 수 있다.  
  
> 사슬 축소  

인과관계 다이어그램은 다음의 회귀 방정식으로 변환할 수 있다.  
$IceCreamSales = \beta_{T}Temperature$  
$DonutSales = \beta_{I}IcedCoffeeSales$  
  
두번째 방정식의 IcedCoffeeSales를 첫번째 방정식의 표현식으로 다음과 같이 대체할 수 있다.  
$DonutSales = \beta_{I}(\beta_{T}Temperature) = (\beta_{I}\beta_{T}Temperature)$  
이때 $\beta_{I}\beta_{T}$는 2개의 상수 계수를 곱한 것이므로 하나의 새로운 계수로 취급할 수 있다.  
$DonutSales=.Temperature$    
결과적으로 도넛 매출을 기온의 선형함수로 표현할 수 있다.  
ex)기온 -> 도넛 매출  
  
만약 사슬의 마지막 변수가 비즈니스 지표로 관심 변수이고 첫번째 변수가 실행 가능한 경우에  
사슬 축소가 유용할 수 있다.  
  
> 사슬 확장  

기존에 기온 -> 도넛 매출 다이어그램에 아이스 커피 매출을 추가할 수 있다.  
기온 -> 아이스 커피 매출 -> 도넛 매출  
이를 사슬을 확장한다고 한다.  
  
기온이 상승했지만 도넛의 매출은 오르지 않았다고 가정할 때 두가지를 생각해볼 수 있다.  
기온이 상승했지만 아이스커피의 매출이 증가하지 않은것, 매장 관리자가 에어컨을 세게  
틀어서 매장안은 밖과 상관없이 시원했기 때문이면 첫번째 화살표가 사라지거나 약해질 수 있다.  
기온이 상승하면서 아이스 커피의 매출이 증가했지만 아이스 커피의 매출 증가가 도넛 매출  
증가로 이어지지 않은것, 도넛 대신 새로 출시된 쿠키를 구매했기 때문이면 두번째 화살표가  
사라지거나 약해질 수 있다.   
  
**사슬을 축소하면 변수가 간접적인 관계가 되고**  
**사슬을 확장하면 간접적인 관계가 직접적인 관계를 갖게 된다.**  
  
> 분기  

변수가 둘 이상의 효과를 일으키는 경우 관계는 분기를 생성한다.  
기온이 아이스크림 매출과 아이스커피 매출의 요인이라고 할 때  
기온은 두 변수에 영향을 미치지만 두 변수 사이에는 관계가 없다.  
날씨가 더우면 아이스크림이나 아이스 커피를 사지만 아이스크림을 산다고 해서  
아이스 커피를 사는 것은 아니고, 다른 것을 샀다고 해서 다른 하나를 살 가능성이  
낮아지는 것도 아니다.   

두 변수에 공통된 요인이 있는 상황은 흔하지만 두 변수 사이에 상관관계가 생겨  
잠재적으로 문제가 될 수도 있다.  
ex)앞의 예시에서 날씨가 더우면 둘 다 매출이 증가하고 추우면 둘 다 매출이 감소한다.  
  
두 변수 사이에 직접적인 인과관계가 성립되지 않는데(=서로 요인이 아닌데)  
두 변수사이의 상관관계를 관찰하게 된다면 공통 요인을 공유하기 때문인 경우가 많다.  
  
인과관계 다이어 그램에서 공통요인을 몰라도 그 존재를 분기로 나타낼 땐 양방향  
화살표로 나타낸다. 보통 두 변수 사이의 상관관계를 관찰하며 어떤 것이 원인인지  
알 수 없을 때에도 양방향 화살표를 사용한다.  
양방향 화살표는 두 변수사이에 상관관계가 존재할 가능성이 있는 세가지 이유를 모두  
상징한다.  
-A는 B를 유발하거나  
-B가 A를 유발할 수 있고   
-혹은 A와 B가 공통 요인을 공유하기 때문일 수 있다.  
  
> 충돌  

2개 이상의 변수가 동일한 결과를 낳으면 관계는 충돌이 생긴다.  
ex)가게의 가판대는 초콜릿, 바닐라 두가지 맛의 아이스크림만 판매해서  
맛과 아이스크림 구매행동을 나타내는 인과관계 다이어그램은 특정 맛의  
선호도가 가판대에서 아이스크림을 구매하게 했다는 것을 의미한다.  
  
**분기는 공통 요인을 제어하지 않으면 문제가 되고**  
**충돌은 공통 결과를 제어하면 문제가 된다.**  
  
ex)  
사슬: 여름해당 여부 > 기온 > 아이스크림 판매량  
분기: 여름해당 여부는 기온과 아이스크림 판매량의 공통 요인이다.  
충돌: 아이스크림 판매량은 기온과 여름해당 여부의 공통 결과이다.  
  
참고 출처:  
https://cse.snu.ac.kr/course/%ED%99%95%EB%A5%A0-%EA%B7%B8%EB%9E%98%ED%94%84-%EB%AA%A8%EB%8D%B8  
https://datascienceschool.net/03%20machine%20learning/17.02%20%EA%B7%B8%EB%9E%98%ED%94%84%20%ED%99%95%EB%A5%A0%EB%AA%A8%ED%98%95.html  