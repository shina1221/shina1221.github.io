---
layout: post
title: 인과관계 다이어그램의 일반적인 변환방법   
date: 2023-08-21 19:20:23 +0900
category: DA
use_math: true
---
# 행동 데이터 분석    
> 변수의 분할/분해  

ex) 기온 > 아이스 커피 매출 > 도넛 매출  
아이스 커피의 종류에 따른 수요를 파악하고자 할때 다음과 같은 인과관계 다이어그램은  
부적합하다.  
아이스 커피 매출을 아이스 커피 종류별 매출로 분할할 수 있다.  
ex)아이스 커피 매출= 아이스 라떼 매출 + 아이스 아메리카노 매출  
  
매개변수가 분할된 사슬로 나타내면 다음과 같다.  
      > 아이스 아메리카노 매출  
기온                           > 도넛매출  
      > 아이스 라떼 매출          
  
이렇게 분할된 변수는 각자의 방정식을 세울 수 있다.  
아이스 아메리카노(IA) 매출 = $\beta_{IA}$.기온  
아이스 라떼(IL) 매출 = $\beta_{IL}$.기온  
  
아이스커피 매출을 분할한 결과 변수가 기온의 매개변수 역할을 하고 도넛 매출에 대해  
통합된 다중 회귀를 생성한다.  
도넛 매출 =  $\beta_{IA}$.기온 + $\beta_{IL}$.기온  

> 변수 집계  

분할된 변수는 다시 합쳐질 수 있고 더 일반화하면 동일한 원인과 결과를 가진 변수를  
집계할 수 있다. 단 모든 변수는 분할할 수 있지만 집계할 때에는 직접 및 간접 관계가  
동일한 변수만 집계할 수 있다.  

인구통계학적 변수는 다양한 변수를 대표하는 의미의 변수며 자세히 살펴볼 필요가 없는  
변수일 수도 있다.  
*A/B 테스트를 하고 인과관계를 파악한다고 가정할 때 무작위화를 사용하면 인구통계학적  
요인(성별, 나이 등)을 제어할 수 있어 해당 요인은 분석에서 제외할 수 있다.  
  
> 순환 관계  

변수는 한 변수의 결과이고 다른 변수의 원인일 수 있지만 동시에 한 변수의 원인이자  
결과일 수는 없다.(ex) A>B>C>A)  
하지만 현실 세계에는 서로가 서로에게 인과적으로 영향을 미치는 **순환 관계**가 있다.  
**행동 데이터 분석 시 순환 관계는 대체효과와 피드백 루프때문에 발생할 수 있다.**  

-대체효과와 피드백 루프  
*고객은 제품의 가용성, 가격, 고객의 다양한 욕구에 따라 제품을 다른 제품으로 대체할 수 있다.  
ex) 기온에 따라 아이스커피 구매에서 뜨거운 커피 구매로 가는 방향으로 인과관계가  
존재할 수 있다.  
다이어그램에서 화살표 방향은 원인은 무엇이고 결과는 무엇인지를 나타낸다.  
  
*피드백 루프: 사람이 환경의 변화에 반응해 행동을 수정하는 것이다.  
ex) 마트 계산줄이 너무 길어서 고객이 구매를 포기하고 돌아간다.  
이러면 마트의 매장 관리자는 줄이 너무 길어질 시 새로운 계산대를 열어 대기줄을 관리한다.  
  
> 순환관리  

순환을 피할 수 있는 경험법칙  
-타이밍에 관심을 가진다.  
거의 모든 경우에 한 변수가 다른 변수에 영향을 미치는데 어느정도 시간이 걸린다.  
따라서 순환을 끊고 비주기적 인과관계 다이어그램 즉 순환이 없는 인과관계  
다이어그램으로 전환할 수 있다.  
ex) 고객이 대기시간이 길다고 인식하는데 15분, 대기줄을 새로열어 대응하는데 15분이  
걸릴 때  
                           > 시간t +15분에서의 대기하는 고객 수  
시간 t에서의 평균 대기시간                                      > 시간 t+15분에서의 평균 구매 대기시간  
                           > 시간t +15분에서의 대기줄 수  
    
대기열 또는 이벤트가 일어나기까지의 시간을 나타내는 변수를 위한 특별한 모델(ex)생존분석)이 따로 있다. 이런 모델은 더 넓은 범주의 GLM에 속하며 로지스틱 회귀와 같이  
효과적인 모델이다.  
  
-인과관계 다이어그램을 단순화하고 가장 관심이 있는 인과관계 경로를 따라가 화살표만  
유지한다. **피드백 효과(변수가 방금 자신에게 영향을 미친 변수에 영향을 미치는 경우)**는  
일반적으로 영향이 적으며 다른 변수가 직전에 준 영향에 비해 훨씬 작아 그 효과의 근사값으로  
무시할 수 있다.  
ex) 아이스 커피와 뜨거운 커피 예제에서 더울 때 아이스 커피의 판매량이 증가하면  
뜨거운 커피의 판매량이 감소하지 않을까하는 걱정이 생길수도 있지만,  
뜨거운 커피의 판매량이 감도하더라도 그것이 다시 아이스 커피의 판매량 증가로  
이어질 가능성은 낮기 때문에 인과관계 다이어그램에서 이 피드백 효과를  
무시할 수 있다.  

> 경로  

화살표의 방향과 상관없이 변수 사이에 화살표가 있으며 연결된 길에 중복된 변수가  
없을 때 변수사이에 경로가 있다고 한다.  
ex)  
여름철 여부 > 아이스크림 매출  
                 ^  
            >  기온  > 아이스 커피 매출  
두가지 경로가 존재한다.  
사슬을 따라가는 경로: 여름철 여부 > 기온 > 아이스 커피 매출  
아이스크림 매출을 거쳐가는 경로: 여름철 여부 > 아이스크림 매출 > 기온 > 아이스 커피 매출  
사슬 뿐만 아니라 분기나 충돌 또한 경로가 된다. 또한 두 변수 사이에 있는 두개의   
서로 다른 경로가 일부 화살표를 공유할 수도 있다. 서로 다른 경로란 적어도 하나 이상의  
화살표가 다른 두 경로를 의미한다.  
ex)예제에서는 기온 > 아이스 커피 매출에 있는 화살표를 공유한다.  
  
유효하지 않은 경로  
ex) 기온 > 여름철 여부 > 아이스크림 매출 > 기온 > 아이스 커피 매출 에서  
기온이 두번 등장하기 때문에 해당 경로는 유효하지 않다.  

> 정리하기  

교란요소가 분석에 편향을 유발할 수 있기 때문에 상관관계는 인과관계가 아니다.  
단순히 사용 가능한 모든 변수를 회귀에 다 포함하는 것은 교란현상을 해결하는 방법이 아니다.  
심지어 잘못된 변수를 제어하면 잘못된 상과관계가 발생하고 새로운 편향이 생길 수도 있다.  
*인과관계 다이어그램에 대한 자세한 내용을 공부하고 싶다면  
주데아 펄과 다나 맥켄지의 The Book of Why를 참조할 것  
