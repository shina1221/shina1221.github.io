---
layout: post
title: 회귀분석을 방해하는 교란
date: 2023-08-02 19:20:23 +0900
category: CS
use_math: true
---
# 행동 데이터 분석  
> 회귀 분석을 방해하는 교란   

예측분석에서는 회귀를 알 수 없는(주로 미래의)값을 추정할 때 사용한다.  
이미 알고 있는 정보를 수집하고 다양한 요소를 종합해 가장 적합한 값을 추측한다.  
이 때 예측한 이유나 방법이 아닌 예측한 값과 정확도가 가장 중요하다.  
  
인과관계 분석에서는 목표변수의 값을 추측하는 것말고도 특정값을 유도한 요인이 무엇인가에 초점을 맞춰  
독립변수와의 관계를 중요하게 본다.    
잘 설계된 회귀분석에서 상관계수는 종속변수에 대한 독립변수의 인과 효과를 잘 나타내는 좋은 지표가 될 수 있다.  
       
예측 분석에서 사용하는 회귀분석을 그대로 사용하면서 주어진 계수로 인과관계를 측정할 수는 없다.  
회귀 분석에서 각 변수는 다른 변수에 영향을 줄 수 있기 때문이다.  
따라서 인과관계 분석에서는 변수를 정확한 예측을 목표로 설정하기 보다 정확한 관계의 계수를 가질 수 있도록  
설계해야 한다.

예제)  
chap1-stand_data.csv: 판매한 아이스 크림과 아이스 커피의 일일 매출 데이터  
chap1-sruvey_data.csv: 매장 밖에 행인을 대상으로 한 설문 조사 
  
A 기업은 날씨가 일일 매출에 영향을 미친다고 생각하고 있다.  
인과용어로 날씨가 매출의 인과요인이라고 판단하는 것이다. 이는 다른 모든 조건이 동일할 때 기온이 높아질수록  
사람들이 아이스크림을 구매할 확률이 증가한다는 것이다.  

! 실제 EDA를 수행해본 결과 git 데이터가 책과 내용이 많이 다르므로 책 내용으로 진행  
  
절편추정치를 제공하는 coefficients(계수)영역을 보면  
temps의 estimate는 1145.320으로 기온이 1도 오를때마다 아이스크림 매출이 1145씩 늘어난다고 볼 수 있다.  
  
이후 10월에 A기업에서 모델의 예측에 따라 가판대의 아이스크림의 재고를 미리 늘렸다고 가정했을 때  
해당 주의 주간 매출은 평소보다 높긴 했지만 모델에서 예측한 값에 미치지 못했다.  
모델이 예측에 실패한 이유는 예측에 결정적인 영향을 미치는 요인을 고려하지 않았기 때문이다. 
대부분의 아이스크림 매출은 학생들이 학교를 가지 않는 여름방학 기간에 발생한다.  
회귀모델은 주어진 데이터를 활용해 최선의 예측을 수행했지만 여름방학의 기간이 기온과 양의 상관관계가 있기 때문에 아이스크림 매출 증가에 영향을 주는 여름방학의 효과를 기온에 의한 것처럼 해석하는 오류가 있었다.  
10월에 기온이 올라가지만 학생들의 여름방학이 생기는 것은 아니므로 같은 기간의 여름방학 기간보다 매출이 낮은 것이었다.  
  
기술적인 용어로 보면 1년 중 판매 시점이 기온과 매출의 관계를 교란하는 요인이다.  
이것을 교란변수라고 하며 회귀모델에 편향을 조성하는 변수를 의미한다.  
교란변수가 있는 환경에서 회귀모델의 계수를 인과관계로 해석하면 잘못된 결론을 내리게 된다.  
  
겨울은 춥고 여름은 매우 더운 대륙성 기후를 보이는 지역에서 매출이 발생한 월을 고려하지 않고 무작위로 더운 날과  
추운날의 아이스크림 매출을 비교한다면 더운 날은 학생들이 학교에 가지않는 여름방학 기간에 추운 날은 학생들이  
학교에 가는 겨울에 속할 가능성이 높다. 이렇게 되면 기온과 매출의 관계를 과대평가하게 될 것이다.  
  
또한 여름방학기간이 아이스크림 구매 행동에 큰 변화를 주지만 회귀 모델에서 오직 기온이라는 변수만으로 이 행동의  
변화를 표현한다면 그 계수는 더운 날씨에 대해 과도하게 크고 추운 날씨에 대해선 과도하게 작을 것이다.  
  
> 사공이 많으면 배가 산으로 간다.  

변수가 너무 많으면 문제가 될 수 있다.  교란 현상을 해결하는 잠재적인 방법은 회귀 모델에 가능한 모든 변수를 포함하는 것이다. 2018년 주데아 펄과 맥켄지에 의하면 관찰된 공변량(covariance)을 조건화하기를 피하는 것은  
비과학적인 임기응변이라고 저술했다. 많은 데이터 과학자들이 이 사고방식에 동의하는데  
  
어떤 변수의 값을 예측하는 것만이 목적이라면 그저 테스트 데이터를 적절히 일반화하는 모델을 만들고 예측된 변수가  
특정 값을 갖는 이유는 궁금해하지 않아도 된다. 하지만 인과관계를 이해하고 이를 기반으로 어떤 의사결정을 내리는   것이 목적이라면 이런 사고방식은 통하지 않는다. 이 경우에는 분석 모델에 가능한 한 모든 변수를 포함하는 것이  
비효율적일 뿐만 아니라 역효과를 일으키고 결과를 왜곡할 수 있다.  
  
위의 예시에서 아이스크림 매출은 기온과 상관관계를 갖지만 여름철 여부변수(7월이나 8월이면1 아니면 0)와 관계가  없다. 여기에 아이스 커피 매출 변수를 추가한 뒤 OLS를 수행하면 기온변수의 coef는 -1651로 바뀐다.  
또한 기온변수와 아이스커피 변수의 p_value가 0.05보다 높은 값을 보이는 결과가 나온다.  
여기서 기온변수의 p_value가 0.408, 아이스 커피판매 변수가 0.184로 나와 기온변수를 모델에서 제거해야 한다는  
결론을 내릴 수도 있다.  
  
사람들은 날씨가 더울수록 아이스 커피를 많이 산다.    
그러나 아이스커피를 구매하는 행위가 아이스크림 구매의 행위에 영향을 주는 것은 아니다.
여름방학을 맞은 학생들은 아이스커피의 주요 구매층이 아니기 때문에 여름이라는 시간 요소는 아이스 커피 구매와  
상관관계가 없다.  

> 자세히 보기  

예제 데이터의 아이스크림 매출은 다음의 공식을 따른다.  
$icecreamsales:= 1000.Temp + 20000.summerMonth +\varepsilon _{i} $


참고 출처:  
https://www.aitimes.com/news/articleView.html?idxno=47051  
https://ko.wikipedia.org/wiki/%EC%B0%A8%EC%9B%90%EC%9D%98_%EC%A0%80%EC%A3%BC  
https://oreil.ly/BehavioralDataAnalysis  


