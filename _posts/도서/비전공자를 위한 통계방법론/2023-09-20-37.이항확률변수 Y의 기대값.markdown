---
layout: post
title: 이항확률변수 Y의 기대값
date: 2023-09-20 19:21:23 +0900
category: statistics 
use_math: true
---      
종속변수가 등간척도나 비율척도가 아닌 명목척도로 측정된 2개의 범주를 가진 경우  
//종속변수의 범주가 3개 이상인 경우에는 다항종속변수 회귀모형  

Y가 정규분포의 특성을 갖는 양적변수일 때 그것을 종속변수로 하는 회귀방정식에서  
$\widehat{Y}$는 Y의 조건부 기대값이다. 여기서 조건부 기대값이란 의미는 특정한 X값이  
주어졌을 때 X값의 조건을 충족하는 개체들의 Y의 기대값을 의미한다.  
$\widehat{Y}= E(Y|X's)=b_0+b_1X_{1i}+b_2X_{2i}+...+b_nX_{ni}$  

Y가 0이나 1값만을 가지는 이항변수일 경우 Y의 조건부 기대값 $E(Y|X's)$는 

확률변수 Y의 기대값은 Y가 취할 수 있는 개별 값에 해당 값이 발생할 확률을 곱한 값들을 모두 더한  
가중평균값이다.  

이항종속변수 Y는 0과 1 두가지 값을 취하기 때문에 0의 값에 그 값이 발생할 확률P(Y=0)을 곱하고,  
1의 값에 그 값이 발생할 확률P(Y=1)을 곱한 뒤 합하면 그것이 이항종속변수 Y의 기대값이 된다.  
**Y가 0 혹은 1을 가지는 이항확률변수 일 대 Y의 기대값은 Y가 1을 가질 확률이 된다.**  

종속변수가 이항변수인 경우 회귀방정식의 $\widehat{Y}$가 의미하는 것은 해당 사건이 발생할 확률인  
Y의 값이 1일 확률이다.  
해당 사건이 발생할 확률은 독립변수들에 의해 영향을 받는데 이때 확률은 0과 1 사이에서 나온다.  

이항종속회귀모형 분석 기법
-선형확률모형  
-로지스틱 회귀모형  
-프로빗 회귀 모형  

선형확률모형과 로지스틱 회귀모형 둘 사이의 차이점은 회귀방정식의 우변을 어느 모양의  
함수로 두는가이다. 1일 확률을 구하는 경우라면 로지스틱 회귀모형이 더 적합하다.  
  
> 선형확률모형  

![선형 확률모형]()
선형확률모형은 회귀방정식의 좌변이 Y=1일 확률을 나타내기 때문이다.  
해당 모형에서 개별 독립변수의 회귀계수 $b_1,b_2...$들은 관련 독립변수의 한 단위 변화가  
해당 사건 발생확률에 어느정도 영향을 미치는지인데 구체적으론 독립변수가 사건의 발생확률에  
미치는 한계효과를 의미한다.  

독립변수가 한 단위 증가할 때마다 Y=1일 확률을 나타내는데 결함이 있다.  
Y가 취할 수 있는 값들은 0이나 1이기 때문에 모든 관측치들은 Y=0이나 Y=1인 선상에 위치한다.  
해당 산포도는 X가 증가함에 따라 Y=1일 가능성이 더 커지는 것을 의미한다.  

문제점  
-Y의 기대값 $\widehat{Y}$이 확률임에도 불구하고 0보다 작거나 1보다 큰 값을 가질 수 있다.  
이는 이항종속변수 회귀방정식에서 Y의 기대값이 0과 1사이에서 나타난다는 점에 위배된다.  
-등분산성 가정이 위배된다.  
등분산 가정은 X값이 달라지더라도 오차편차 $y_i-\widehat{Y}$의 제곱합으로 표현되는 분산이  
동일해야 한다는 것이다.  
하지만 선형확률모형에서는 X값이 달라지면서 오차편차의 크기도 달라질 수 있어 오차의 등분산성 가정에 위배된다.(X값이 달라지면서 오차의 분산이 달라짐=이분산) (그림 참조)  
이분산 현상이 존재하면 일반 회귀모형에서 최적의 회귀식을 찾았을 때 적용하던 최소제곱법이  
제대로 된 추정치를 제공할 수 없게 된다.  
이를 보완하기 위해 가중최소제곱법이라는 분석기법을 사용하기도 한다.  
  
> 로지스틱 회귀모형  

$\widehat{Y} = P(Y=1|X's) = \frac{exp(b_0+b_1 \cdot x_{1i}+b_2 \cdot x_{2i}+...+b_k \cdot x_{ki})}{1+exp(b_0+b_1 \cdot x_{1i}+b_2 \cdot x_{2i}+...+b_k \cdot x_{ki})}$  
  
독립변수가 하나로 구성된 로지스틱 회귀방정식에서 회귀계수가 정해지면  
이항종속변수 Y의 조건부 기대값과 독립변수 X의 관계는 다음과 같아진다.  
독립변수에 포함된 변수의 값을 대입해 그 조건하에서 관련 사건이 발생할 확률 $\widehat{Y}$  
만약 $b_0=3, b_1=-2$일 경우  
$\widehat{Y}= P(Y=1|X) = \frac{e^{3-2X_i}}{1+e^{3-2X_i}}$  
식이 이와같이 복잡한 이유는 $\widehat{Y}$값이 Y=1일 확률(관련 사건이 발생할 확률)이면서 그 값의  
범위가 0이상 1이하임을 감안할 때 로지스틱 함수가 다음 값의 범위를 가장 잘 나타내주기 때문이다.  

*로지스틱 회귀방정식의 회귀계수를 구하는 방식  
최소제곱법이 아닌 **최대우도법**을 사용한다.  
현재 확보한 표본 관측치가 나올 수 있는 확률을 최대로 높여주는 모집단 모수의 추정치를 찾아  
회귀계수 값으로 제공하는 원리이다.  

> 회귀계수의 해석  

-odds ratio에 미치는 효과  
$ln \frac{P}{1-P}=b_0+b_1 \cdot x_{1i}+b_2 \cdot x_{2i}+...+b_k \cdot x_{ki}$  
분모는 Y=0일 확률, 분자는 Y=1일 확률을 두고 둘 사이의 비율에 자연로그(ln)을 취한것이다.  
$\frac{P}{1-P}$를 두고 odds비라 칭한다. 
**odds비는 관련 사건이 발생할 확률이 해당 사건이 발생하지 않을 확률의 몇 배인지를 나타낸다.**  
odds비 값이 1이면 Y=1일 확률이 0.5이고 Y=0일 확률도 0.5가 되며 관련 사건이 발생할 확률과  
발생하지 않을 확률이 0.5로 동일하다는 의미이다.  
**로짓(logit)dms odds에 자연로그를 취한 식을 말하며 이를 로짓 회귀방정식이라 한다.**  

ex) 특정 행사에 참가할지 여부를 결정하는데 미치는 설명변수로 행사장으로부터 1시간 이내 지역에  
거주하는지 여부(1시간 내 거주 시 $X_1=0$, 1시간 외 거주 시 $X_1=1$)과 행사참가비($X_2$ 단위  
1000원)을 설정하고 로지스틱 회귀분석을 실행한 결과 다음의 로짓 회귀방정식을 얻었다고 해본다.  

$\widehat{Y} = P(Y=1|X's) = \frac{e^{5.315-1.702X_{1i}-0.184X_{2i}}}{1+e^{5.315-1.702X_{1i}-0.184X_{2i}}}$  
$ln \frac{P}{1-P}=ln(odds)=5.315-1.702X_{1i}-0.184X_{2i}$  
  
![로지스틱 회귀모형]()  
특정 설명변수의 회귀계수는 해당 설명변수가 한 단위만큼 변할 때 좌변의 ln(odds)가 얼만큼  
변하는지를 나타낸다.  
행사장으로부터의 거리 $X_1$의 회귀계수 -1.702가 의미하는 바는 행사참가비 $X_2$가 동일하다면  
$X_1=0$일 때의 ln(odds)값에 비해 한 단위 증가한 X=1일 때의 ln(odds)값이 1.702만큼 작아진다는 것을 의미한다.  (ln(odds_1/odds_0)=-1.702)=$e^{-1.702}=0.182$  
행사장으로부터의 거리가 1시간 이내인 상황에서 1시간 이상인 상황으로 바뀌면 odds비가 0.182가  
된다는 의미이다.     
  
*로그의 기본특성  
통상 log의 밑수가 10인 경우 밑수를 생략해 logX라고 표기한다.  
밑수가 2.7182....인 경우 자연로그라 하고 lnX라고 표기한다.  
$lnX = a$이면 $X=e^a; logX=a$이면 $X=10^a$  
$logA \cdot B= logA+logB$
$log \frac{A}{B}=logA-logB$  

> 정리  

P=사건이 발생할 확률  
$\frac{P}{1-P}$=오즈(odds)  
$ln\frac{P}{1-P}$=ln(odds)=로짓(logit)  
$ln(odds1)-ln(odds0)=ln(\frac{odds1}{odds0})$=오즈비(odds ratio)  
  
연속변수 $X_2$의 회귀계수 -0.184는 X_1이 동일하다고 할 때  
행사참가비가 ($X_2=30$)에서 한단위 오른 31은 $X_2$가 30일 때 odds에 비해  
로짓(ln(odds))이 0.184만큼 작아진다는 것(ln(odds1)-ln(odds0)=-0.184)을 의미한다.  
따라서 오즈비는 $ e^{-0.184}=0.832$가 된다.  
이는 행사장으로부터 거리가 동일할 때 행사참가비를 1000원 인상하면 오즈비가 0.832가 된다는 의미이다.  

> 일반화  

이항종속변수를 포함하고 있는 로지스틱 회귀모형에서 설명변수 $X_k$의 회귀계수 $b_k$는  
$X_k=a+1$일 때 로짓값 $ln(odds_0)$에 비해 X_k=a+1일 때의 로짓값 $ln(odds_1)$이 ln(odds_1)이  
$b_k$만큼 변화한다는 의미이다.  
이는 두 odds간 비율(오즈비)이 $e^{b_k}$라는 의미이다.  
  
> 오즈비의 활용  

$(e^{b_k}-1)*100$=설명변수$b_k$의 한 단위 증가에 따른 odds의 변화백분율  
ex) 행사참가비의 한 단위 변화에 따른 오즈비가 0.832일 때 변화백분율은 -16.8%  
이는 행사참가비가 1000원 인상되면 odds1이 odds0에 비해 16.8% 감소한다는 의미이다.  

개인해석) 오즈가 줄어든다는 것은 
ex)0.7/0.3(odds1) < 0.8/0.2(odds0) 이처럼 odds1이 더 작아진다는 것이라고 해석된다.  
이는 사건이 발생하지 않을 확률에 비해 사건이 발생할 확률이 더 작아진다는 것으로 해석되며  
큰 맥락에서 회귀계수 변화에 따라 사건이 발생할 확률이 더 작아짐을 의미하는듯 하다.  
  
> $X_k$가 C(여러) 단위 증가함에 따른 오즈비와 그에 근거한 오즈의 변화백분율  
오즈비 = $\frac{odds1}{odds0}=e^{c \cdot b_k}$  

로지스틱 회귀방정식의 회귀계수를 해석할 때 로지스틱 회귀방정식을 로짓 회귀정정식으로 전환한 뒤  
개별 설명변수의 변화가 오즈비에 어떤 변화를 가져오는지에 맞춰 해석한다. 

> 사건발생확률에 미치는 효과  

로지스틱 회귀방정식
$\widehat{Y} = P(Y=1|X's) = \frac{exp(b_0+b_1 \cdot x_{1i}+b_2 \cdot x_{2i}+...+b_k \cdot x_{ki})}{1+exp(b_0+b_1 \cdot x_{1i}+b_2 \cdot x_{2i}+...+b_k \cdot x_{ki})}$로 부터  
특정 설명변수 $X_k$가 관련 사건이 발생할 확률($widehat{Y}$)에 미치는 한계효과를 계산할 수 있다.  
이는 해당 로지스틱 회귀방정식을 대상으로 설명변수 $X_k$에 대해 1차 편미분을 실행해 순간변화율을  
계산하면 된다. 이것이 곧 $X_k$가 $widehat{Y}$에 미치는 한계효과를 의미한다.  
$\frac{\delta \widehat{Y}}{\delta X_k}=b_k \cdot P(1-P)$  

여기서 순간변화율이 관련 사건이 발생할 확률 P의 함수이기 때문에 $X_k$의 한 단위 증가분에 따른   
P(Y=1)의 순간변화율은 모든 구간에서 $b_k$로 동일하지 않고 $X_k$의 증가분이 어느 확률(P)  
수준에서 이뤄지느냐에 따라 그 지점에서의 순간변화율이 달라진다.  
이는 로지스틱 함수가 초기에는 완만하게 상승하다가 이어 급격하게 상승하는 구간을 지나  
다시 완만하게 변하는 비선형 함수이기 때문이다. (1차 함수일 때만 순간변화율을 나타내는 기울기가  
구간에 관계없이 동일). 따라서 설명변수가 관련 사건의 발생확률에 미치는 한계효과를 구할 때에는  
P값이 얼마일 때(혹은 그 P값에 영향을 미치는 $X_k$의 값이 얼마일 때)의 한계효과를 구할 것인지를  
명확하게 해야한다.  

ex) 행사참가비 $X_2$가 30000원(30)에서 31000(31)으로 인상될 경우 인상된 행사참가비 1000원이  
행사참가 확률에 미치는 효과는 다음과 같다.  
$\frac{\delta \widehat{Y}}{\delta X_k}=0.184 * 0.449 * 0.551 = -0.046$  
행사장까지의 거리는 1시간 이내인 경우 행사참가비를 30000원에서 1000원을 올리면  
행사참가율이 0.046만큼 감소한다고 해석할 수 있다.  

> 모집단 모수의 추정  

로지스틱 회귀모형에서 연구자들의 관심은 독립변수에 포함시킨 특정 설명변수가 이항종속변수에 어떤  
영향을 미치는지, 오즈비에 어떠한 영향을 미치는지이다.  
관심대상이 되는 모집단 모수는 설명변수 $X_k$의 회귀계수 $\beta_k$가 된다.  
검정통계량의 확률분포는 표본의 크기가 클 수록 표준정규분포의 특성을 따르기 때문에 z검증을 수행한다.  
가설검증 시 귀무가설로 $\beta_k=0$을 설정한다.  
검증통계량  
$\frac{b_k- \beta_k}{SE}$  

#wald 검증통계치  
검증통계량 값을 제곱한 값으로 카이제곱분포(자유도:1)의 특성을 따른다.  
#우도비 검증통계치
대부분의 통계프로그램은 최대우도법을 사용해 회귀모형을 분석할 때마다 해당 회귀모형에 딸린  
우도비(-2 log likelihood로 표기)값을 제공한다.  
우도비는 일반 다중회귀모형에서 회귀모형 자체의 유의성을 검증할 때 사용한 F검정과 비슷한것이다.  
$\beta_k$에 대한 유의성을 검증할 때 사용되는 우도비 검증통계치는 $X_k$를 포함한 완전회귀모형의  
우도비($LR_R$)값과 $X_k$를 포함하지 않은 제한회귀모형의 우도비값의 차이가 된다.  
(우도비 검증통계치 = $LR_R-LR_F$) 그리고 이것은 카이제곱 분포(자유도:1)의 특성을 가진다.  
만약 우도비 검증통계치가 0으로 나왔다면 $X_k$의 회귀계수 $\beta_k$값이 0이라는 것이다.  

wald 검증과 우도비 검증은 표본이 커질수록 결과가 일치하지만  
표본크기가 크지 않을 경우 두 검증으로부터 얻은 결과는 다를 수 있다.  
만약 두 검증의 결과가 일치하지 않을 경우 **우도비 검증 결과를 따를것을 권한다.**  

*  
로지스틱 회귀모형의 경우 등분산 가정을 충족하지 못하기 때문에 최대우도법을 사용해 회귀계수의  
추정치를 계산한다. 이런 조건에서 얻은 회귀계수 추정량은 최적의 추정량이 갖춰야 할 세가지 특성  
(불편성, 효율성, 일치성)을 동시에 갖추지 못한다.  
어느 검증통계치를 사용하는지에 따라 효율성(표본오차 값이 작을수록 효율성이 좋음.)면에서 차이가  
존재하기 때문에 z 검증통계량, wald 검증통계치, 우도비 검증통계치에서 각각의 귀무가설  
기각여부에 차이가 발생할 수 있다.  
  
> 회귀계수 $\beta_k$에 대한 추정 및 검증  

-양측검증  
로지스틱 회귀모형에 포함된 개별 회귀계수 $\beta_k$에 대한 유의성 검증은 다중회귀모형에서  
개별 회귀계수에 대한 유의성을 검증하는 방식과 유사하다.  
대립가설 $\beta_k$는 0이 아닐 것이다.  
각 표본분포상에서 $\alpha$값에 연계되어 정해지는 기각영역 경계값과 검증통계치를 비교해 검증통계치가 귀무가설 기각영역 경계값(z검증의 경우 $-z_{\alpha/2}$나 $z_{\alpha/2}$,  
wald 검증이나 우도비검증의 경우 $\chi^2_{1-\alpha/2,1}$나 $\chi^2_{\alpha/2,1}$)을 벗어나면  
혹은 p값이 유의수준 $\alpha$보다 작거나 같으면 대립가설을 채택한다.  

-단측검증  
변수 $X_k$가 사건의 발생확률(Y=1일 확률)에 +적인 영향을 미칠 것이다. 라는 연구가설을 검증하고자하면 이는 우측검증에 해당한다.  
대립가설: $\beta_k>0$  
유의성 여부는 개별 검증통계치가 귀무가설 기각영역 경계값(z검증의 경우 $z_\alpha$, wald 검증이나 우도비검증의 경우 $\chi^2_{\alpha,1}$)보다 더 크거나 같으면 대립가설을 채택한다.  
p-값을 유의수준 $\alpha$와 비교해 귀무가설 기각여부를 결정할 수도 있다.  

> 로지스틱 회귀모형의 유의성 검증  

대립가설: 모든 독립변수의 회귀계수는 0이 아닐 것이다.  
해당 가설을 검증할 때에는 우도비 검증통계치로 확률분포는 카이제곱분포(자유도: 독립변수의 수 k)이다.  
검증통계치가 카이제곱분포상에서 귀무가설 기각영역 경계값 $\chi^2_{1-\alpha/2,1}$나 $\chi^2_{\alpha/2,1}$를 벗어나면, p-값이 유의수준 $\alpha$보다 작을 경우 대립가설을 채택한다.  




참고 출처:  
https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EB%B9%97_%ED%9A%8C%EA%B7%80_%EB%AA%A8%ED%98%95  
